<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Ninja Mobile</title>
</head>

<body>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"
        integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO"
        crossorigin="anonymous"></script>
        <button id="startButton" >Start</button>
    <script>

        let speed = 0;
        const scalingFactor = 10; // Adjust this factor to control how much farther the objects move

        function client() {
            const socket = io();
            const orientationDisplay = document.getElementById('orientation');

            function handleOrientation(event) {
                const { alpha, beta, gamma } = event;
                const data = { alpha, beta, gamma };
                socket.emit('acceleration', data);
                orientationDisplay.textContent = `Alpha: ${alpha?.toFixed(2)}, Beta: ${beta?.toFixed(2)}, Gamma: ${gamma?.toFixed(2)}`;
            }

            function requestOrientationPermission() {
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                window.addEventListener('deviceorientation', handleOrientation);
                                window.addEventListener('devicemotion', handleMotion);
                            } else {
                                orientationDisplay.textContent = 'Permission to access device orientation was denied';
                            }
                        })
                        .catch(console.error);
                } else if ('DeviceOrientationEvent' in window) {
                    window.addEventListener('deviceorientation', handleOrientation);
                    window.addEventListener('devicemotion', handleMotion);
                } else {
                    orientationDisplay.textContent = 'Device Orientation API not supported.';
                }
            }

            // Handle device motion event
            function handleMotion(event) {
                const acceleration = event.accelerationIncludingGravity;

                if (acceleration) {
                    const deltaX = acceleration.x - prevAcceleration.x;
                    const deltaY = acceleration.y - prevAcceleration.y;
                    const deltaZ = acceleration.z - prevAcceleration.z;

                    // Calculate the speed (magnitude of acceleration change)
                    speed = Math.sqrt(deltaX * deltaX + deltaY * deltaY + deltaZ * deltaZ);

                    // Update previous acceleration values
                    prevAcceleration.x = acceleration.x;
                    prevAcceleration.y = acceleration.y;
                    prevAcceleration.z = acceleration.z;

                    // Use the speed to influence the bat or objects
                    // Example: Move objects or adjust bat speed based on `speed`
                    moveObjectsBasedOnSpeed(speed * scalingFactor);
                }
            }

            function moveObjectsBasedOnSpeed(speed) {
                // Implement your logic here to move objects or influence gameplay based on `speed`
                console.log('Device speed:', speed);
            }

            document.getElementById('startButton').addEventListener('click', requestOrientationPermission);
        }

        if (typeof document !== "undefined") {
            client();
        }
    </script>
</body>

</html>